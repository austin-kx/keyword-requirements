name: Version Enforcement
on:
    pull_request:
        branches: [master] # Only run if the PR is trying to enter master

jobs:
    version-check:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
            - name: Get Versions
              run: |
                  echo "PR_VERSION=$(cat VERSION)" >> $GITHUB_ENV
                  echo "MAIN_VERSION=$(git show origin/master:VERSION)" >> $GITHUB_ENV
            - name: Run Version Script
              shell: node {0}
              env:
                  PR_VERSION: ${{ env.PR_VERSION }}
                  MAIN_VERSION: ${{ env.MAIN_VERSION }}
              run: require('./.github/scripts/check-version.js')
